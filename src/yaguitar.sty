%
% This file is under MPL 2.0 License
%
\ifx\makeatletter\undefined
  \def\makeatletter{\catcode`\@=11 }\relax
  \def\makeatother{\catcode`\@=12 }\relax
\fi
%
\makeatletter
%
\def\theChord#1{\strut{\bf #1}\hbox to 2pt{\hss}}%
%
\def\chordSharp{\raise 4pt\hbox{$\sharp$}}%
\def\chordFlat{\raise 4pt\hbox{$\flat$}}%
%
\newdimen\chordskip \chordskip=\baselineskip
%
% macros for saving original definitions of active chars
%
\def\y@gSaveSharp{}
\def\y@gSaveFlat{}
\def\y@gSaveBracket{}
\def\y@gSaveSpace{}
\def\y@gSaveNewLine{}
%
% Active characters inside chord (# = sharp, b = flat)
%
\def\y@gActivateChordChars {\catcode`\#=13\catcode`b=13\relax}%
\def\y@gDeactivateChordChars {\catcode`\#=6\catcode`b=11\relax}%
%
\y@gActivateChordChars
%
\def\y@gChordCharsOn{%
\y@gActivateChordChars
\let\y@gSaveFlat b\let b\chordFlat
\let\y@gSaveSharp #\let #\chordSharp
}%
%
\def\y@gChordCharsOff{%
\let b\y@gSaveFlat
\let # \y@gSaveSharp
\y@gDeactivateChordChars
}%
%
\y@gDeactivateChordChars
%
\def\chord{\y@gChordCharsOn\y@gChord}%
%
\def\y@gChord#1{\relax
  \hskip 0pt
  \raise \chordskip \hbox to 0pt{\theChord{#1}\hss}\y@gChordCharsOff
}
%
\def\y@gChordEnv{\y@gChordCharsOn\y@gChordBracket}%
\def\y@gChordBracket#1]{\y@gChord{#1}}%
%
%
%
\def\y@gActivateEnvChars{\catcode`\^^M=13\catcode`\[=13\catcode`\ =13}%
\def\y@gDeactivateEnvChars{\catcode`\^^M=5\catcode`\[=12\catcode`\ =10}%
%
\def\y@gNewLine{\par\leavevmode}%
\def\y@gSpace{{ }}%
%
%
%
\y@gActivateEnvChars%
%
\def\y@gOn{\y@gActivateEnvChars%
\let\y@gSaveBracket[\let[\y@gChordEnv%
\let\y@gSaveNewLine^^M\let^^M\y@gNewLine%
\let\y@gSaveSpace \let \y@gSpace%
}%
%
\def\y@gOff{%
\let[\y@gSaveBracket%
\let^^M\y@gSaveNewLine%
\let \y@gSaveSpace%
\y@gDeactivateEnvChars%
}%
%
\y@gDeactivateEnvChars%
%
%
%
\def\guitarOn{\y@gOn}%
%
\def\guitarOff{\y@gOff}%
%
\makeatother
\endinput
